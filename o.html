<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Komentar Merdeka</title>
<style>
:root{--merah:#d50000;--merah-tua:#b71c1c;--putih:#ffffff;}
*{box-sizing:border-box;}
html,body{margin:0;padding:0;font-family:'Segoe UI',Arial,sans-serif;}
body{color:#fff;background:url('FESTARA03.jpg') center/cover no-repeat fixed;position:relative;}
body::before{content:"";position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:-1;}
header{background:var(--merah);border-bottom:3px solid var(--putih);padding:18px 12px;text-align:center;}
header h1{margin:0;font-size:clamp(1.4rem,3.5vw,2.2rem);font-weight:800;letter-spacing:.5px;}
main{max-width:720px;margin:18px auto;padding:16px;background: rgba(255,255,255,.08);border-radius:14px;backdrop-filter: blur(2px);box-shadow:0 10px 30px rgba(0,0,0,.25);}
#formKomentar{background: rgba(255,255,255,.92); color:#222; border-radius:14px; padding:18px; box-shadow:0 8px 24px rgba(0,0,0,.35); margin:0 auto 16px; max-width:560px;}
#formKomentar input,#formKomentar textarea{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #ddd;outline:none;transition:border-color .2s ease;font-size:15px;margin-bottom:10px;}
#formKomentar input:focus,#formKomentar textarea:focus{border-color: var(--merah);}
#formKomentar textarea{min-height:110px;resize: vertical;}
#formKomentar button{width:100%;padding:12px 14px;border:none;border-radius:10px;cursor:pointer;color:#fff;font-weight:800;letter-spacing:.3px;background:linear-gradient(90deg,var(--merah),#ff1744);transition: transform .06s ease, filter .2s ease;}
#formKomentar button:hover{filter: brightness(.97);} #formKomentar button:active{transform: translateY(1px);}
h2{text-align:center;margin:10px 0 12px;font-weight:800;color:#ffebee;}
#daftarKomentar{display:grid;gap:10px;max-width:720px;margin:0 auto;}
.komentar{background: rgba(255,255,255,.92); color:#222; border-left:5px solid var(--merah); border-radius:12px; padding:12px 14px; box-shadow:0 6px 18px rgba(0,0,0,.25); overflow-wrap:anywhere; word-break:break-word; white-space:pre-wrap;}
.meta{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:8px;font-size:.9rem;color:#555;}
.hapus-btn{background:var(--merah-tua);color:#fff;border:none;border-radius:8px;cursor:pointer;padding:6px 10px;font-size:.85rem;font-weight:700;transition:filter .2s ease, transform .06s ease;}
.hapus-btn:hover{filter: brightness(.95);} .hapus-btn:active{transform: translateY(1px);}
footer{text-align:center;margin:12px 0;font-size:.9rem;color:#eee;}
</style>
</head>
<body>
<header><h1>KOMENTAR MERDEKA</h1></header>

<main>
<form id="formKomentar" autocomplete="off">
<input type="text" id="nama" placeholder="Nama" required />
<textarea id="isi" placeholder="Tulis komentar..." required></textarea>
<button type="submit">Kirim</button>
</form>

<h2>Daftar Komentar</h2>
<div id="daftarKomentar"></div>
</main>

<footer>Buatan Sekbid 8</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, serverTimestamp, deleteDoc, doc, query, orderBy } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyD8MS2ZX8MaB-VbuUmrRtN-FyEOnqExjFA",
authDomain: "festara03.firebaseapp.com",
databaseURL: "https://festara03-default-rtdb.firebaseio.com",
projectId: "festara03",
storageBucket: "festara03.firebasestorage.app",
messagingSenderId: "415555427034",
appId: "1:415555427034:web:c3f83ede55d952c1e7e3e3",
measurementId: "G-G12DMSY19K"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const daftarKomentar = document.getElementById("daftarKomentar");
const form = document.getElementById("formKomentar");
const inputNama = document.getElementById("nama");
const inputIsi = document.getElementById("isi");

const ADMIN_PASSWORD = "MerahPutih2025";

// Toast popup
function showToast(message){
const toast = document.createElement("div");
toast.textContent = message;
toast.style.position="fixed";
toast.style.bottom="20px";
toast.style.left="50%";
toast.style.transform="translateX(-50%)";
toast.style.background="rgba(0,0,0,0.85)";
toast.style.color="#fff";
toast.style.padding="10px 16px";
toast.style.borderRadius="8px";
toast.style.boxShadow="0 4px 12px rgba(0,0,0,.4)";
toast.style.zIndex="9999";
toast.style.opacity="0";
toast.style.transition="opacity 0.3s ease";
document.body.appendChild(toast);
setTimeout(()=>{toast.style.opacity="1";},50);
setTimeout(()=>{toast.style.opacity="0"; setTimeout(()=>{toast.remove();},300);},2000);
}

// Render komentar
function renderKomentar(){
const q=query(collection(db,"komentar"), orderBy("waktu","desc"));
onSnapshot(q, snap=>{
daftarKomentar.innerHTML="";
snap.forEach(docSnap=>{
const data = docSnap.data();
const waktu = data?.waktu?.seconds ? new Date(data.waktu.seconds*1000).toLocaleString() : "";
const konten=document.createElement("div");
konten.className="komentar";
const isiDiv=document.createElement("div");
isiDiv.textContent=`${data?.nama || "Anonim"}: ${data?.isi || ""}`;
const metaDiv=document.createElement("div");
metaDiv.className="meta";
const small=document.createElement("small");
small.textContent=waktu||"â€”";
metaDiv.appendChild(small);

// tombol hapus untuk admin
const hapusBtn=document.createElement("button");
hapusBtn.className="hapus-btn";
hapusBtn.textContent="Hapus";
hapusBtn.addEventListener("click",async()=>{
const pw=prompt("Masukkan password admin untuk hapus komentar:");
if(pw===ADMIN_PASSWORD){
konten.style.transition="opacity 0.4s ease, transform 0.4s ease";
konten.style.opacity="0";
konten.style.transform="translateY(-20px)";
setTimeout(async()=>{
try{ await deleteDoc(doc(db,"komentar",docSnap.id)); }
catch(e){ alert("Gagal hapus: "+(e?.message||e)); konten.style.opacity="1"; konten.style.transform="translateY(0)"; }
},400);
}else{ alert("Password salah!"); }
});
metaDiv.appendChild(hapusBtn);

konten.appendChild(isiDiv);
konten.appendChild(metaDiv);
daftarKomentar.appendChild(konten);
});
});
}

renderKomentar();

// Submit komentar
form.addEventListener("submit", async e=>{
e.preventDefault();
const nama=inputNama.value.trim();
const isi=inputIsi.value.trim();
if(!nama||!isi) return;
try{
await addDoc(collection(db,"komentar"), {nama, isi, waktu:serverTimestamp()});
inputNama.value=""; inputIsi.value="";
showToast("Komentar berhasil dikirim!");
}catch(e){ alert("Gagal mengirim komentar: "+(e?.message||e)); }
});
</script>
</body>
</html>